<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Mastering SaaS â€” æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600;700&family=Bebas+Neue&family=IBM+Plex+Sans+JP:wght@300;400;600&display=swap');

  :root {
    --bg: #03050a;
    --surface: #080d14;
    --card: #0c1220;
    --border: #162030;
    --border2: #1e3050;
    --text: #b8c8d8;
    --muted: #3d5570;
    --accent: #00e5ff;
    --gemini: #4285f4;
    --claude: #d97706;
    --gpt: #10b981;
    --gcs: #a855f7;
    --warn: #f59e0b;
    --danger: #ef4444;
    --ok: #22d3a8;
    --white: #e8f0f8;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    line-height: 1.6;
    padding: 40px 36px 80px;
  }

  /* HEADER */
  .header {
    margin-bottom: 48px;
  }
  .header h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 42px;
    letter-spacing: 3px;
    color: var(--white);
    line-height: 1;
  }
  .header .sub {
    color: var(--muted);
    font-size: 11px;
    margin-top: 6px;
    letter-spacing: 1px;
  }
  .header .tagline {
    margin-top: 12px;
    font-family: 'IBM Plex Sans JP', sans-serif;
    font-size: 13px;
    color: var(--accent);
  }

  /* SECTION TITLE */
  .sec-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 16px;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 16px;
    margin-top: 48px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 8px;
  }

  /* â”€â”€â”€ PIPELINE â”€â”€â”€ */
  .pipeline {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .pipe-row {
    display: grid;
    grid-template-columns: 32px 1fr;
    gap: 0 20px;
    position: relative;
  }

  .pipe-line {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .pipe-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
    margin-top: 18px;
    position: relative;
    z-index: 2;
  }

  .pipe-connector {
    width: 1px;
    flex: 1;
    min-height: 12px;
  }

  .pipe-body {
    padding: 14px 0 20px 0;
  }

  /* STAGE CARD */
  .stage {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px 20px;
    margin-bottom: 2px;
  }

  .stage-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .stage-num {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    color: var(--muted);
    line-height: 1;
    min-width: 24px;
  }

  .stage-title {
    font-family: 'IBM Plex Sans JP', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: var(--white);
  }

  .badge {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 9px;
    padding: 2px 7px;
    border-radius: 3px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .badge.gemini  { background: #0d1f4a; color: var(--gemini); }
  .badge.claude  { background: #2d1a00; color: var(--claude); }
  .badge.gpt     { background: #052e1c; color: var(--gpt); }
  .badge.gcs     { background: #1a0d2e; color: var(--gcs); }
  .badge.dsp     { background: #0d1f33; color: var(--accent); }
  .badge.mail    { background: #1a1a00; color: var(--warn); }
  .badge.player  { background: #1a0d0d; color: var(--danger); }
  .badge.multi   { background: #0d2020; color: var(--ok); }

  .stage-desc {
    font-family: 'IBM Plex Sans JP', sans-serif;
    font-size: 12px;
    color: var(--text);
    margin-bottom: 12px;
    line-height: 1.7;
  }

  /* DETAIL GRID */
  .detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 8px;
  }

  .detail-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 10px 12px;
  }

  .detail-label {
    font-size: 9px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 4px;
  }

  .detail-value {
    font-size: 11px;
    color: var(--text);
  }

  .detail-value code {
    background: #050810;
    padding: 1px 5px;
    border-radius: 3px;
    color: var(--accent);
    font-size: 10px;
  }

  /* AGENT TRIO */
  .agent-trio {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
    margin-top: 10px;
  }

  .agent-card {
    border-radius: 6px;
    padding: 12px 14px;
    border: 1px solid;
  }

  .agent-card.gemini { background: #050f1e; border-color: #162a5a; }
  .agent-card.claude { background: #1a1000; border-color: #3d2a00; }
  .agent-card.gpt    { background: #031a0e; border-color: #0d3d1e; }

  .agent-name {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 14px;
    letter-spacing: 1px;
    margin-bottom: 6px;
  }

  .agent-name.gemini { color: var(--gemini); }
  .agent-name.claude { color: var(--claude); }
  .agent-name.gpt    { color: var(--gpt); }

  .agent-role {
    font-size: 10px;
    color: var(--muted);
    margin-bottom: 8px;
  }

  .agent-tools {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .agent-tools li {
    font-size: 10px;
    color: var(--text);
    padding-left: 10px;
    position: relative;
  }

  .agent-tools li::before {
    content: 'â†’';
    position: absolute;
    left: 0;
    color: var(--accent);
    font-size: 9px;
  }

  /* FUNCTION CALLS */
  .fn-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .fn-item {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 12px;
    align-items: start;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 10px 14px;
  }

  .fn-name {
    font-size: 11px;
    color: var(--accent);
    white-space: nowrap;
  }

  .fn-desc {
    font-size: 11px;
    color: var(--muted);
  }

  .fn-caller {
    font-size: 9px;
    padding: 2px 6px;
    border-radius: 3px;
    white-space: nowrap;
  }

  .fn-caller.gemini { background: #0d1f4a; color: var(--gemini); }
  .fn-caller.claude { background: #2d1a00; color: var(--claude); }
  .fn-caller.gpt    { background: #052e1c; color: var(--gpt); }
  .fn-caller.all    { background: #0d2020; color: var(--ok); }

  /* GCS LAYOUT */
  .gcs-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
  }

  .gcs-bucket {
    background: var(--surface);
    border: 1px solid #2a1550;
    border-radius: 6px;
    padding: 12px 14px;
  }

  .gcs-bucket-name {
    font-size: 10px;
    color: var(--gcs);
    margin-bottom: 4px;
    font-weight: 600;
  }

  .gcs-bucket-path {
    font-size: 9px;
    color: var(--muted);
    margin-bottom: 6px;
  }

  .gcs-files {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .gcs-files li {
    font-size: 9px;
    color: var(--text);
    padding-left: 10px;
    position: relative;
  }

  .gcs-files li::before {
    content: 'ğŸ“„';
    position: absolute;
    left: 0;
    font-size: 8px;
  }

  /* PLAYER PROTECTION */
  .protect-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .protect-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 10px 12px;
  }

  .protect-label {
    font-size: 10px;
    color: var(--danger);
    margin-bottom: 4px;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .protect-value {
    font-size: 11px;
    color: var(--text);
  }

  /* ISSUE CALLOUT */
  .callout {
    margin-top: 8px;
    background: #1a0a00;
    border: 1px solid #3d2000;
    border-radius: 5px;
    padding: 10px 14px;
    font-size: 11px;
    color: #f59e0b;
  }

  .callout strong { color: #fbbf24; }

  /* CONNECTOR ARROW */
  .arrow-connector {
    text-align: center;
    padding: 4px 0;
    color: var(--border2);
    font-size: 18px;
    padding-left: 52px;
  }

</style>
</head>
<body>

<div class="header">
  <h1>AI Mastering SaaS</h1>
  <div class="sub">NEW ARCHITECTURE â€” GCS + MULTI-AGENT + FUNCTION CALLING</div>
  <div class="tagline">Gemini ã§åˆ†æ â†’ 3 AI åˆè­°ã§æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ â†’ DSP å‡¦ç† â†’ ä¿è­·ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é…ä¿¡</div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STAGE 1 â€” UPLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="sec-title">PIPELINE</div>

<div class="pipeline">

<div class="stage" style="border-left: 3px solid var(--gcs)">
  <div class="stage-header">
    <span class="stage-num">01</span>
    <span class="stage-title">éŸ³æºã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ GCS ä¿å­˜</span>
    <span class="badge gcs">GCS</span>
  </div>
  <div class="stage-desc">
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ WAV / AIFF ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚ç½²åä»˜ã URL ã§ GCS ã«ç›´æ¥PUTã€‚
    ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’çµŒç”±ã—ãªã„ãŸã‚é«˜é€Ÿã‹ã¤å¸¯åŸŸã‚³ã‚¹ãƒˆæœ€å°ã€‚
  </div>
  <div class="detail-grid">
    <div class="detail-item">
      <div class="detail-label">ä¿å­˜å…ˆãƒã‚±ãƒƒãƒˆ</div>
      <div class="detail-value"><code>gs://mastering-raw/{userId}/{jobId}/input.wav</code></div>
    </div>
    <div class="detail-item">
      <div class="detail-label">ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¦ä»¶</div>
      <div class="detail-value">WAV / AIFF / FLAC â€” æœ€å¤§ 24bit/96kHz</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹å¼</div>
      <div class="detail-value">GCS Signed URL (PUT, 15åˆ†æœ‰åŠ¹)</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">å®Œäº†é€šçŸ¥</div>
      <div class="detail-value">GCS Pub/Sub â†’ Cloud Run ã§ã‚¸ãƒ§ãƒ–èµ·å‹•</div>
    </div>
  </div>
</div>

<div class="arrow-connector">â†“</div>

<!-- STAGE 2 â€” GEMINI ANALYSIS -->
<div class="stage" style="border-left: 3px solid var(--gemini)">
  <div class="stage-header">
    <span class="stage-num">02</span>
    <span class="stage-title">Gemini ã«ã‚ˆã‚‹éŸ³éŸ¿åˆ†æï¼ˆ33é …ç›®ï¼‰</span>
    <span class="badge gemini">GEMINI</span>
  </div>
  <div class="stage-desc">
    Gemini ãŒ GCS ã®éŸ³æºã‚’ç›´æ¥å‚ç…§ã—ã€55é …ç›®ã®ã†ã¡åˆ†æç³»33é …ç›®ã‚’ç®—å‡ºã€‚
    Function Calling ã§æ§‹é€ åŒ– JSON ã¨ã—ã¦è¿”å´ã€‚ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ãªã—ãƒ»æ±ºå®šè«–çš„ã€‚
  </div>
  <div class="agent-trio" style="grid-template-columns: 1fr;">
    <div class="agent-card gemini">
      <div class="agent-name gemini">Gemini 2.0 Flash</div>
      <div class="agent-role">éŸ³éŸ¿ç‰¹å¾´é‡ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼</div>
      <ul class="agent-tools">
        <li>LUFS / LRA / True Peak / Crest Factor (BS.1770æº–æ‹  Ké‡ã¿ã‚ã‚Š)</li>
        <li>ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡º (intro/verse/build/drop/break/chorus/outro) + energyLevel</li>
        <li>å‘¨æ³¢æ•°å¸¯åŸŸã‚¨ãƒãƒ«ã‚®ãƒ¼ (6band) / ã‚¹ãƒ†ãƒ¬ã‚ªå¹… / ä½ç›¸ç›¸é–¢</li>
        <li>æ­ªã¿ç‡ / ãƒã‚¤ã‚ºãƒ•ãƒ­ã‚¢ / ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ãƒªã‚¹ã‚¯äºˆæ¸¬</li>
        <li>çµæœã‚’ <code>gs://mastering-analysis/{jobId}/analysis.json</code> ã«ä¿å­˜</li>
      </ul>
    </div>
  </div>
</div>

<div class="arrow-connector">â†“</div>

<!-- STAGE 3 â€” 3AI COUNCIL -->
<div class="stage" style="border-left: 3px solid var(--ok)">
  <div class="stage-header">
    <span class="stage-num">03</span>
    <span class="stage-title">3 AI åˆè­° â€” Beatport Top10 åŸºæº–ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ±ºå®š</span>
    <span class="badge multi">MULTI-AGENT</span>
  </div>
  <div class="stage-desc">
    analysis.json ã‚’3ã¤ã® AIã«ä¸¦åˆ—ã§æ¸¡ã™ã€‚å„ AI ãŒç‹¬è‡ªã®è¦–ç‚¹ã§ MasteringParams ã®æœ€é©å€¤ã‚’ Function Calling ã§è¿”å´ã€‚
    Orchestratorï¼ˆClaudeï¼‰ãŒæŠ•ç¥¨ãƒ­ã‚¸ãƒƒã‚¯ã§æœ€çµ‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºå®šã€‚
  </div>
  <div class="agent-trio">
    <div class="agent-card gemini">
      <div class="agent-name gemini">Gemini</div>
      <div class="agent-role">Composer è¦–ç‚¹ï¼ˆæ¥½æ›²æ§‹é€ ãƒ»ã‚°ãƒ«ãƒ¼ãƒ–ï¼‰</div>
      <ul class="agent-tools">
        <li>ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ tubeDrive ææ¡ˆ</li>
        <li>ãƒ‰ãƒ­ãƒƒãƒ—ã®ãƒ‘ãƒ³ãƒæ„Ÿæœ€å¤§åŒ–</li>
        <li>ä½åŸŸè¼ªéƒ­ (Pultec 55Hz) æœ€é©å€¤</li>
        <li>story / groove / character ã‚¹ã‚³ã‚¢</li>
      </ul>
    </div>
    <div class="agent-card claude">
      <div class="agent-name claude">Claude</div>
      <div class="agent-role">Engineer è¦–ç‚¹ï¼ˆå®‰å…¨æ€§ãƒ»ä½ç›¸ãƒ»æ­ªã¿ï¼‰</div>
      <ul class="agent-tools">
        <li>limiter_ceiling / attack ã®æœ€çµ‚æ±ºå®š</li>
        <li>Ké‡ã¿ LUFS ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®š</li>
        <li>distortion / clipping ãƒªã‚¹ã‚¯è©•ä¾¡</li>
        <li>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•´åˆæ€§ã®æœ€çµ‚æ‰¿èª</li>
      </ul>
    </div>
    <div class="agent-card gpt">
      <div class="agent-name gpt">ChatGPT</div>
      <div class="agent-role">Audience è¦–ç‚¹ï¼ˆãƒªã‚¹ãƒŠãƒ¼ä½“é¨“ãƒ»ç–²åŠ´æ„Ÿï¼‰</div>
      <ul class="agent-tools">
        <li>ãƒ©ã‚¦ãƒ‰ãƒã‚¹æ„Ÿ vs ç–²åŠ´ã®ãƒãƒ©ãƒ³ã‚¹</li>
        <li>high air (+4.5dB shelf) é‡ã®èª¿æ•´</li>
        <li>Neuro-Drive wetMix ææ¡ˆ</li>
        <li>Beatport Top10 æ¯”è¼ƒã‚¹ã‚³ã‚¢</li>
      </ul>
    </div>
  </div>
  <div class="callout">
    <strong>åˆè­°ãƒ«ãƒ¼ãƒ«ï¼ˆOrchestrator = Claudeï¼‰ï¼š</strong>
    3ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¸­å¤®å€¤ã‚’åŸºæœ¬æ¡ç”¨ã€‚Engineer è¦–ç‚¹ãŒ REJECT ã‚’å‡ºã—ãŸå ´åˆã¯ãã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¼·åˆ¶çš„ã«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ææ¡ˆå€¤ã«å·®ã—æ›¿ãˆã€‚å…¨å“¡ APPROVE ã§ç¢ºå®š â†’ <code>params.json</code> ã‚’ GCS ã«ä¿å­˜ã€‚
  </div>
</div>

<div class="arrow-connector">â†“</div>

<!-- STAGE 4 â€” DSP -->
<div class="stage" style="border-left: 3px solid var(--accent)">
  <div class="stage-header">
    <span class="stage-num">04</span>
    <span class="stage-title">Dynamic Adaptive Mastering â€” DSP å‡¦ç†</span>
    <span class="badge dsp">DSP ENGINE</span>
  </div>
  <div class="stage-desc">
    ç¢ºå®šã—ãŸ params.json ã‚’å—ã‘å–ã‚Šã€æ—¢å­˜ audioService.ts ã® buildMasteringChain ã‚’ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã«å®Ÿè¡Œã€‚
    è‡ªå·±è£œæ­£ãƒ«ãƒ¼ãƒ—ï¼ˆoptimizeMasteringParamsï¼‰ã§æœ€çµ‚ LUFS èª¿æ•´ã€‚
  </div>
  <div class="detail-grid">
    <div class="detail-item">
      <div class="detail-label">å‡¦ç†ç’°å¢ƒ</div>
      <div class="detail-value">Cloud Run (Node.js + Web Audio API ãƒãƒªãƒ•ã‚£ãƒ« / Wasm)</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥å‡¦ç†</div>
      <div class="detail-value">intro/verse/drop ç­‰ã§ tubeDrive / neuroDriveMix ã‚’å‹•çš„åˆ‡æ›¿</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">LUFS ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</div>
      <div class="detail-value">Beatport: -8ã€œ-6 LUFS / Spotify: -14 LUFSï¼ˆãƒ—ãƒ©ãƒ³è¨­å®šï¼‰</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">å‡ºåŠ›å…ˆ</div>
      <div class="detail-value"><code>gs://mastering-output/{jobId}/mastered.wav</code></div>
    </div>
  </div>
</div>

<div class="arrow-connector">â†“</div>

<!-- STAGE 5 â€” PROTECTION PLAYER -->
<div class="stage" style="border-left: 3px solid var(--danger)">
  <div class="stage-header">
    <span class="stage-num">05</span>
    <span class="stage-title">ä¿è­·ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é…ä¿¡ï¼ˆMasteringVisualizerï¼‰</span>
    <span class="badge player">PROTECTED</span>
  </div>
  <div class="stage-desc">
    å‡¦ç†æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã¯ GCS ã®ç½²åä»˜ã URL ã§ã®ã¿ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿå¯èƒ½ã€‚
    ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰è³¼å…¥å‰ã¯ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ç‰ˆã®ã¿ã€‚è³¼å…¥å¾Œã«é«˜éŸ³è³ªãƒ•ã‚¡ã‚¤ãƒ«ã® URL ã‚’ç™ºè¡Œã€‚
  </div>
  <div class="protect-grid">
    <div class="protect-item">
      <div class="protect-label">ğŸ”’ å†ç”Ÿæ–¹å¼</div>
      <div class="protect-value">GCS ç½²åä»˜ã URLï¼ˆ15åˆ†TTLï¼‰ â†’ Web Audio API ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã€‚srcå±æ€§ã«ç›´æ¥ URL ã‚’æ¸¡ã•ãªã„ã€‚</div>
    </div>
    <div class="protect-item">
      <div class="protect-label">ğŸ”’ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é˜²æ­¢</div>
      <div class="protect-value">ArrayBuffer ã§å–å¾—å¾Œ AudioContext ã«æ¸¡ã™ã€‚&lt;audio&gt; ã‚¿ã‚°ä¸ä½¿ç”¨ã€‚å³ã‚¯ãƒªãƒƒã‚¯ãƒ»devtools ã‹ã‚‰ã® URL å–å¾—ã‚’é˜²æ­¢ã€‚</div>
    </div>
    <div class="protect-item">
      <div class="protect-label">ğŸ”’ ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯</div>
      <div class="protect-value">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‰ˆã¯ 20ç§’ã”ã¨ã« -12dB ã®ãƒ“ãƒ¼ãƒ—ã‚’åŸ‹ã‚è¾¼ã‚€ï¼ˆDSPå‡¦ç†æ™‚ã«ç”Ÿæˆï¼‰</div>
    </div>
    <div class="protect-item">
      <div class="protect-label">ğŸ’³ è³¼å…¥ãƒ•ãƒ­ãƒ¼</div>
      <div class="protect-value">Stripe Checkout â†’ æ±ºæ¸ˆå®Œäº† Webhook â†’ 24æ™‚é–“æœ‰åŠ¹ã®ç½²åä»˜ããƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ URL ç™ºè¡Œ</div>
    </div>
  </div>
</div>

<div class="arrow-connector">â†“</div>

<!-- STAGE 6 â€” EMAIL -->
<div class="stage" style="border-left: 3px solid var(--warn)">
  <div class="stage-header">
    <span class="stage-num">06</span>
    <span class="stage-title">å®Œäº†é€šçŸ¥ãƒ¡ãƒ¼ãƒ« + AI ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</span>
    <span class="badge mail">EMAIL</span>
  </div>
  <div class="stage-desc">
    ãƒã‚¹ã‚¿ãƒªãƒ³ã‚°å®Œäº†å¾Œã€Claude ãŒåˆ†æçµæœã¨3AIåˆè­°ã‚¹ã‚³ã‚¢ã‚’ã‚‚ã¨ã«æ—¥æœ¬èªã®è‡ªç„¶è¨€èªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç”Ÿæˆã€‚
    SendGrid ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ã®ãƒªãƒ³ã‚¯ã¨è³¼å…¥ãƒœã‚¿ãƒ³ã‚’å«ã‚€ã€‚
  </div>
  <div class="detail-grid">
    <div class="detail-item">
      <div class="detail-label">ãƒ¡ãƒ¼ãƒ«å†…å®¹</div>
      <div class="detail-value">åˆè­°ã‚¹ã‚³ã‚¢ / ä¸»è¦æ”¹å–„ç‚¹ / Beatportæ¯”è¼ƒ / ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼URL / è³¼å…¥ãƒœã‚¿ãƒ³</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">é€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹</div>
      <div class="detail-value">SendGrid (Transactional)</div>
    </div>
  </div>
</div>

</div><!-- /pipeline -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GCS STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="sec-title">GCS ãƒã‚±ãƒƒãƒˆæ§‹é€ </div>
<div class="gcs-grid">
  <div class="gcs-bucket">
    <div class="gcs-bucket-name">mastering-raw</div>
    <div class="gcs-bucket-path">gs://mastering-raw/{userId}/{jobId}/</div>
    <ul class="gcs-files">
      <li>input.wav â€” ã‚ªãƒªã‚¸ãƒŠãƒ«åŸç›¤ï¼ˆå¤‰æ›´ä¸å¯ï¼‰</li>
      <li>metadata.json â€” ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚æƒ…å ±</li>
    </ul>
  </div>
  <div class="gcs-bucket">
    <div class="gcs-bucket-name">mastering-analysis</div>
    <div class="gcs-bucket-path">gs://mastering-analysis/{jobId}/</div>
    <ul class="gcs-files">
      <li>analysis.json â€” Gemini 33é …ç›®å‡ºåŠ›</li>
      <li>params.json â€” 3AIåˆè­°ç¢ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
      <li>consensus.json â€” å„AIã‚¹ã‚³ã‚¢è©³ç´°</li>
      <li>sections.json â€” ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºçµæœ</li>
    </ul>
  </div>
  <div class="gcs-bucket">
    <div class="gcs-bucket-name">mastering-output</div>
    <div class="gcs-bucket-path">gs://mastering-output/{jobId}/</div>
    <ul class="gcs-files">
      <li>mastered.wav â€” å®Œæˆå“ï¼ˆ24bit/44.1kHzï¼‰</li>
      <li>preview_wm.wav â€” ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ç‰ˆ</li>
      <li>report.json â€” MQIãƒ»æœ€çµ‚ã‚¹ã‚³ã‚¢</li>
    </ul>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FUNCTION CALLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="sec-title">Function Calls ä¸€è¦§</div>
<div class="fn-list">
  <div class="fn-item">
    <div class="fn-name">analyze_audio_full</div>
    <div class="fn-desc">GCS URI ã‹ã‚‰éŸ³æºã‚’èª­ã¿è¾¼ã¿ã€33é …ç›®ã® FullAnalysis ã‚’è¿”ã™ã€‚Ké‡ã¿LUFSå¿…é ˆã€‚</div>
    <div class="fn-caller gemini">Gemini</div>
  </div>
  <div class="fn-item">
    <div class="fn-name">detect_sections</div>
    <div class="fn-desc">ã‚¨ãƒãƒ«ã‚®ãƒ¼å¤‰åŒ–ã‹ã‚‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã‚’æ¤œå‡ºã€‚å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã® type / energyLevel / rms ã‚’è¿”ã™ã€‚</div>
    <div class="fn-caller gemini">Gemini</div>
  </div>
  <div class="fn-item">
    <div class="fn-name">propose_mastering_params</div>
    <div class="fn-desc">FullAnalysis + SectionDetection[] â†’ MasteringParams + SectionMasteringParams[] ã‚’ææ¡ˆã€‚è¦–ç‚¹ã”ã¨ã«ç‹¬ç«‹å‘¼ã³å‡ºã—ã€‚</div>
    <div class="fn-caller all">å…¨AI</div>
  </div>
  <div class="fn-item">
    <div class="fn-name">run_consensus</div>
    <div class="fn-desc">3ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ææ¡ˆã‚’å—ã‘å–ã‚Šã€ä¸­å¤®å€¤ãƒ™ãƒ¼ã‚¹ã§æœ€çµ‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºå®šã€‚REJECTæ™‚ã¯å¼·åˆ¶ä¸Šæ›¸ãã€‚</div>
    <div class="fn-caller claude">Claude</div>
  </div>
  <div class="fn-item">
    <div class="fn-name">score_beatport_compatibility</div>
    <div class="fn-desc">æœ€çµ‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ Beatport Top10 çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒã—ã€äº’æ›ã‚¹ã‚³ã‚¢ (0-100) ã‚’è¿”ã™ã€‚</div>
    <div class="fn-caller gpt">ChatGPT</div>
  </div>
  <div class="fn-item">
    <div class="fn-name">apply_mastering_chain</div>
    <div class="fn-desc">ç¢ºå®š params.json ã¨ input.wav GCS URI ã‚’å—ã‘å–ã‚Šã€DSPå‡¦ç†å¾Œã« mastered.wav ã‚’ GCS ã«æ›¸ãè¾¼ã‚€ã€‚</div>
    <div class="fn-caller claude">Claude</div>
  </div>
  <div class="fn-item">
    <div class="fn-name">generate_feedback_report</div>
    <div class="fn-desc">åˆè­°ã‚¹ã‚³ã‚¢ + MQI + FullAnalysis ã‹ã‚‰æ—¥æœ¬èªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆã€‚ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã«ä½¿ç”¨ã€‚</div>
    <div class="fn-caller claude">Claude</div>
  </div>
  <div class="fn-item">
    <div class="fn-name">issue_preview_url / issue_download_url</div>
    <div class="fn-desc">GCS ç½²åä»˜ã URL ã‚’ç”Ÿæˆã€‚preview ã¯15åˆ†TTL+ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ç‰ˆã€‚download ã¯è³¼å…¥å¾Œ24æ™‚é–“TTLã€‚</div>
    <div class="fn-caller claude">Claude</div>
  </div>
</div>

</body>
</html>
